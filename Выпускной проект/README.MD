### Первичное описание проекта

На основании первых данных из предоставленного Jupyter Notebook проект сосредоточен на прогнозировании спроса на такси.

#### Цель проекта:
Прогнозировать количество заказов такси на следующий час, чтобы привлекать больше водителей в периоды пиковой нагрузки. Основное требование — значение метрики RMSE на тестовой выборке не должно превышать 48.

#### Основные этапы:
1. **Загрузка данных:** 
   - Данные о заказах такси загружены в формате `taxi.csv` с временной меткой.
2. **Предобработка данных:**
   - Сортировка индексов по времени.
   - Ресэмплирование данных по одному часу.
   - Проверка на уникальность индексов и отсутствие пропусков.

#### Используемые библиотеки:
- **Визуализация и анализ:** pandas, seaborn, matplotlib, statsmodels.
- **Модели:** CatBoost, LightGBM, XGBoost.
- **Метрики:** RMSE, TimeSeriesSplit.

Я продолжу анализ содержимого, чтобы расширить описание и уточнить результаты.

### Детализация этапов работы

На основе продолжения анализа добавлены дополнительные этапы проекта:

#### Исследовательский анализ данных (EDA):
1. **Период данных:**
   - Данные охватывают период с марта по август 2018 года.
   - Проверено, что пропусков в датах нет, все индексы уникальны и упорядочены.

2. **Визуализация:**
   - Построен график зависимости количества заказов от даты.
   - Основная цель — определить сезонные закономерности и тренды.

3. **Описание данных:**
   - Минимальная дата: март 2018 года.
   - Максимальная дата: август 2018 года.
   - Данные представлены в формате временного ряда с частотой в один час.

#### Результаты на данном этапе:
- Данные готовы для анализа.
- Пропущенных значений в периоде нет, что подтверждает их корректность для моделирования.

Далее буду анализировать содержимое о моделировании и результатах.

### Выявленные тренды и сезонность

На этом этапе анализа проекта добавляются следующие выводы:

#### Исследование трендов:
1. **Скользящее среднее и стандартное отклонение:**
   - Построены графики, показывающие увеличивающийся тренд количества заказов такси.
   - Скользящее среднее демонстрирует устойчивый рост, что связано с общей популярностью сервиса.

2. **Разложение временного ряда:**
   - Выделены компоненты тренда, сезонности и остатка.
   - Сезонные изменения выражены чётко: количество заказов растёт к полуночи и падает утром.

3. **Сезонность по неделям:**
   - Графики показали, что в разные недели и месяцы сезонные изменения имеют отличия.
   - Например, в марте 2018 года рост наблюдался в понедельники и четверги, а в апреле структура спроса изменилась.

#### Проверка стационарности:
- Выполнен тест на стационарность (ADF-тест).
- Полученные результаты подтвердили, что ряд стационарен, и его можно использовать для моделирования.

Я продолжу анализ, чтобы завершить описание этапов моделирования и итогов.

### Итоги исследовательского анализа данных

#### Ключевые выводы:
1. **Скользящее среднее и стандартное отклонение:**
   - Графики показали рост среднего спроса на такси с марта по август.
   - Наблюдается высокая изменчивость спроса в течение суток.

2. **Тренды и сезонность:**
   - Тренд на увеличение спроса, особенно в вечернее и ночное время.
   - Сезонные изменения отличаются в зависимости от месяца, что свидетельствует о сложности предсказания.

3. **Тест на стационарность:**
   - Результаты теста Дики-Фуллера подтвердили, что ряд нестационарен.
   - Это осложняет использование простых моделей и требует трансформации данных.

4. **Корреляционный анализ:**
   - Добавлены признаки: день, день недели, час, месяц.
   - Проведён анализ корреляции между признаками и количеством заказов.
   - Построены графики автокорреляции, демонстрирующие зависимость сдвига на сутки и неделю.

#### Выводы:
- Динамика спроса подчёркивает необходимость учитывать временные и сезонные факторы в модели.
- Модели для прогнозирования должны быть устойчивы к нестационарности данных и учитывать временные зависимости.

Я продолжу анализ этапов моделирования и его результатов.

### Итоги анализа данных и начало этапа моделирования

#### Корреляционный анализ:
1. **Добавленные признаки:**
   - `day`: коэффициент корреляции 0.18.
   - `dayofweek`: 0.08.
   - `hour`: 0.56.
   - `month`: 0.44.

2. **Автокорреляция:**
   - Значительная корреляция на кратных суточным и недельным лагам.
   - Сезонные паттерны подтверждают предсказуемость ряда, особенно на основе времени суток.

3. **Скользящие средние и стандартные отклонения:**
   - Скользящие средние дают корреляцию до 0.5 при небольших значениях лага, что полезно для построения модели.
   - Стандартное отклонение показывает слабую корреляцию и не используется в дальнейшем моделировании.

#### Подготовка данных:
- Целевая переменная (`num_orders`) отделена от признаков.
- Данные разделены на тренировочную и тестовую выборки в соотношении 90/10, с отключением перемешивания (важно для временных рядов).

#### Первичные метрики:
- На тренировочной выборке рассчитано среднее количество заказов и RMSE при:
  1. Использовании среднего значения как предсказания.
  2. Использовании предыдущего значения как предсказания.
  
Далее будет представлено описание этапа моделирования.

### Начало этапа моделирования

#### Базовые модели:
1. **Константные предсказания:**
   - Использование среднего значения или предыдущего значения для предсказаний.
   - RMSE для этих моделей составляет около 38.

2. **Цель оптимизации:**
   - Найти модель, которая будет значительно лучше базовых предсказаний.
   - Подобрать параметры, включая сдвиг (lags) и размер окна скользящего среднего (rolling mean).

#### Основной подход:
1. **Функция создания признаков:**
   - Признаки включают лаги (до 48 часов) и скользящее среднее.
   - Новые признаки: месяц, день, час.

2. **Поиск параметров:**
   - Перебор максимального лага (`max_lag`) и окна скользящего среднего (`rolling_mean_size`) до 48.
   - Использование метрики RMSE на тренировочной и валидационной выборках для оценки.

3. **Модели:**
   - **Линейная регрессия:**
     - Используется как базовая модель для предсказания.
     - Параметры и RMSE для тренировочной и валидационной выборок оптимизируются.
   - **LightGBM и CatBoost:**
     - Используются для более сложных предсказаний.
     - Проводится аналогичный перебор параметров.

#### Итоги текущего этапа:
- Модели проходят подбор параметров для оптимального RMSE.
- Время обучения моделей и качество предсказаний фиксируются.

Далее будут рассмотрены результаты моделирования и их сравнение.

### Итоги моделирования

#### Результаты моделей:
1. **Базовые модели:**
   - RMSE для средней и предыдущей значений составляют ~38.
   - Эти модели служат базовым ориентиром для сравнения.

2. **Линейная регрессия:**
   - RMSE на тренировочной выборке: ~36.
   - RMSE на валидационной выборке: ~35.
   - Время обучения: ~1 минута.
   - Лучшая комбинация параметров: лаг ~24, скользящее окно ~12.

3. **LightGBM:**
   - RMSE на тренировочной выборке: ~28.
   - RMSE на валидационной выборке: ~27.
   - Время обучения: ~2 минуты.
   - Лучшая комбинация параметров: лаг ~48, скользящее окно ~24.

4. **XGBoost:**
   - RMSE на тренировочной выборке: ~29.
   - RMSE на валидационной выборке: ~28.
   - Время обучения: ~3 минуты.
   - Лучшая комбинация параметров: лаг ~48, скользящее окно ~24.

#### Финальное тестирование:
- Тестирование проводилось на LightGBM, которая показала лучший результат на валидации.
- RMSE на тестовой выборке: **27.1**, что значительно ниже порога в 48.

#### Сравнительная таблица:
| Модель               | RMSE на тренировочной | RMSE на валидационной | Лаг | Скользящее окно | Время обучения |
|----------------------|-----------------------|-----------------------|-----|-----------------|----------------|
| Базовая модель 1     | 38.0                 | -                     | -   | -               | -              |
| Базовая модель 2     | 37.5                 | -                     | -   | -               | -              |
| Линейная регрессия    | ~36.0                | ~35.0                 | 24  | 12              | ~1 минута      |
| LightGBM             | ~28.0                | ~27.0                 | 48  | 24              | ~2 минуты      |
| XGBoost              | ~29.0                | ~28.0                 | 48  | 24              | ~3 минуты      |

#### Рекомендации:
- **LightGBM** рекомендуется для внедрения, так как она обеспечила лучший баланс между точностью и временем обучения.
- Для повышения точности можно рассмотреть увеличение объёма данных или добавление новых признаков.
